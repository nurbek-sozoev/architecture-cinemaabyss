# CinemaAbyss Kong Proxy

Kong-based API Gateway –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã CinemaAbyss —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∞–Ω–∞—Ä–µ–µ—á–Ω—ã—Ö —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –æ—Ç –º–æ–Ω–æ–ª–∏—Ç–∞ –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ö–∞–Ω–∞—Ä–µ–µ—á–Ω—ã–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è** - –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
- **Load Balancing** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ —Å –≤–µ—Å–æ–≤—ã–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º
- **Rate Limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - Prometheus –º–µ—Ç—Ä–∏–∫–∏ –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - CORS, JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **Admin UI** - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Kong

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
proxyKong/
‚îú‚îÄ‚îÄ docker-compose.yml      # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
‚îú‚îÄ‚îÄ kong.yml               # –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Kong
‚îú‚îÄ‚îÄ env.example           # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ kong.conf         # –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Kong
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ start.sh          # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ kong-config.sh    # –°–∫—Ä–∏–ø—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ README.md             # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üõ† –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
nano .env
```

### 2. –ó–∞–ø—É—Å–∫ Kong

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f kong
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Kong Admin API
curl -i http://localhost:8001/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Kong Proxy
curl -i http://localhost:8000/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞ —Ñ–∏–ª—å–º–æ–≤
curl -i http://localhost:8000/api/movies
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–∞–Ω–∞—Ä–µ–µ—á–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

–í —Ñ–∞–π–ª–µ `kong.yml` –∏–∑–º–µ–Ω–∏—Ç–µ –≤–µ—Å–∞ –≤ —Å–µ–∫—Ü–∏–∏ `upstreams`:

```yaml
upstreams:
  - name: movies-upstream
    targets:
      # –ú–æ–Ω–æ–ª–∏—Ç - 30% —Ç—Ä–∞—Ñ–∏–∫–∞
      - target: host.docker.internal:3280
        weight: 30
      # –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å - 70% —Ç—Ä–∞—Ñ–∏–∫–∞
      - target: host.docker.internal:3281
        weight: 70
```

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Admin API

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Å–∞ –º–æ–Ω–æ–ª–∏—Ç–∞ (30%)
curl -X PATCH http://localhost:8001/upstreams/movies-upstream/targets/host.docker.internal:3280 \
  -d "weight=30"

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Å–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ (70%)
curl -X PATCH http://localhost:8001/upstreams/movies-upstream/targets/host.docker.internal:3281 \
  -d "weight=70"
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Prometheus –º–µ—Ç—Ä–∏–∫–∏

Kong —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus:

```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
curl http://localhost:8001/metrics
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –ª–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ Docker:

```bash
# –õ–æ–≥–∏ Kong
docker-compose logs -f kong

# –õ–æ–≥–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose logs -f kong-database
```

### Admin UI (Konga)

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Kong –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:1337

## üîÄ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

| –ú–∞—Ä—à—Ä—É—Ç       | –°–µ—Ä–≤–∏—Å           | –û–ø–∏—Å–∞–Ω–∏–µ                  |
| ------------- | ---------------- | ------------------------- |
| `/api/movies` | movies-upstream  | –ö–∞–Ω–∞—Ä–µ–µ—á–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ |
| `/api/events` | events-service   | –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Å–æ–±—ã—Ç–∏–π       |
| `/health`     | monolith-service | Health check              |
| `/`           | monolith-service | –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ             |

## üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Rate Limiting

- `/api/movies` - 100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω, 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å
- `/api/events` - 150 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω, 1500 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å

### CORS

–ù–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –≤—Å–µ—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:

- –õ—é–±—ã–µ origins (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ HTTP –º–µ—Ç–æ–¥—ã
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞

### JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–µ–Ω—ã consumers –¥–ª—è frontend –∏ admin —Å JWT –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–∞—Ä–µ–µ—á–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

```bash
# –û—Ç–ø—Ä–∞–≤–∫–∞ 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
for i in {1..100}; do
  curl -s http://localhost:8000/api/movies > /dev/null
  echo "Request $i sent"
done

# –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
docker-compose logs kong 2>&1 | grep "api/movies" | tail -20
```

### –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

```bash
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –º–æ–Ω–æ–ª–∏—Ç
curl -H "X-Kong-Route: monolith" http://localhost:8000/api/movies

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
curl -H "X-Kong-Route: microservice" http://localhost:8000/api/movies
```

## üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

### DB-less —Ä–µ–∂–∏–º (–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π)

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–µ–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

1. –ò–∑–º–µ–Ω–∏—Ç–µ –≤ `docker-compose.yml`:

```yaml
environment:
  KONG_DATABASE: "off"
  KONG_DECLARATIVE_CONFIG: /kong/kong.yml
```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Kong:

```bash
docker-compose down
docker-compose up -d kong
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
kong config parse kong.yml

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (DB-less —Ä–µ–∂–∏–º)
curl -X POST http://localhost:8001/config \
  -F config=@kong.yml
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è Kong

```bash
# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Kong
curl http://localhost:8001/status

# –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
curl http://localhost:8001/services

# –°–ø–∏—Å–æ–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤
curl http://localhost:8001/routes

# –°–ø–∏—Å–æ–∫ upstreams
curl http://localhost:8001/upstreams
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ upstream —Å–µ—Ä–≤–∏—Å–∞–º

```bash
# Health check –º–æ–Ω–æ–ª–∏—Ç–∞
curl http://localhost:8001/upstreams/movies-upstream/health

# –°–ø–∏—Å–æ–∫ targets
curl http://localhost:8001/upstreams/movies-upstream/targets
```

### –õ–æ–≥–∏ –∏ –æ—à–∏–±–∫–∏

```bash
# –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ Kong
docker-compose logs -f kong

# –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose logs -f kong-database

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker exec -it proxykong_kong_1 kong config check
```

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Kong Documentation](https://docs.konghq.com/)
- [Kong Admin API](https://docs.konghq.com/gateway/latest/admin-api/)
- [Kong Plugins](https://docs.konghq.com/hub/)
- [Prometheus Plugin](https://docs.konghq.com/hub/kong-inc/prometheus/)

## üèó –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–∏–º Node.js –ø—Ä–æ–∫—Å–∏

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞     | Node.js Proxy    | Kong Gateway           |
| ------------------ | ---------------- | ---------------------- |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –°—Ä–µ–¥–Ω—è—è          | –í—ã—Å–æ–∫–∞—è                |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è       | –ö–æ–¥ + –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —á–µ—Ä–µ–∑ API |
| –ü–ª–∞–≥–∏–Ω—ã            | –°–∞–º–æ–ø–∏—Å–Ω—ã–µ       | –ì–æ—Ç–æ–≤—ã–µ + –∫–∞—Å—Ç–æ–º–Ω—ã–µ    |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥         | –ë–∞–∑–æ–≤–æ–µ          | Prometheus + Admin UI  |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å   | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è     | –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è         |
| Enterprise —Ñ—É–Ω–∫—Ü–∏–∏ | –ù–µ—Ç              | –ï—Å—Ç—å                   |
